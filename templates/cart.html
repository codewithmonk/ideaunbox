{% extends '_base.html' %}

{% block content %}
    <div class="container">
        {% for item in items.cart_items %}
        <div class="card p-2 m-3", style="width: 60%" id="{{item.sku}}-{{item.option}}-div">
            <div class="mx-5"><img src="{{item.url}}" class="h-width-10 mx-3"></div>
            <div class="d-flex justify-content-around">
                <div class="m-2 justify-content-center">
                    {% comment %} <div><img src="{{item.url}}" class="h-width-10 mx-3"></div> {% endcomment %}
                    <div>{{ item.name }}</div>
                </div>
                <div class="m-2">
                    <div>Option: {{ item.option|upper }}</div>
                    <div>Price: ₹{{ item.cost }}</div>
                </div>
                <div class="m-2">
                    <div class="justify-content-center row mb-5">
                        <button class="btn fa fa-minus p-1 mx-2" onclick="changeQuantity('{{item.sku}}', '{{item.option}}', 'decrement')"></button>
                        <input type="number justify-content-center w-25 rounded" name="quantity" min="1" value="1" id="{{item.sku}}-{{item.option}}-quantity" onchange="changeQuantity('{{item.sku}}', '{{item.option}}', 'change')">
                        <button class="btn fa fa-plus p-1 mx-2" onclick="changeQuantity('{{item.sku}}', '{{item.option}}', 'increment')"></button>
                        <button class="btn fa fa-trash ml-3" style="color: #DC143C" onclick="deleteItem('{{item.sku}}', '{{item.option}}')"></button>
                    </div>
                </div>
            </div>
        </div>
        
        {% endfor %}
    </div>
    
    {% comment %} <div class="container-fluid " style="background: #F5F5F5 !important;">
        <div class="row">
            <div class="col-lg-7 one">
                {% for item in items.cart_items %}
                <div class="card row ml-3 mt-3" style="width: 80%" id="{{item.sku}}-{{item.option}}-div">
                    <div class="column mb-5">
                        <div class="row m-3"><img src="{{item.url}}" class="img-fluid img-thumbnail h-width-10 "></div>
                        <div>
                            {{ item.sku }}
                            {{ item.price }} x <span id="{{item.sku}}-{{item.option}}-quantity-inner"> {{1}} </span>
                        </div>
                        <div class="justify-content-center row mb-5">
                            <button class="btn fa fa-minus p-1 mx-2" onclick="changeQuantity('{{item.sku}}', '{{item.option}}', 'decrement')"></button>
                            <input type="number justify-content-center w-25 rounded" name="quantity" min="1" value="1" id="{{item.sku}}-{{item.option}}-quantity" onchange="changeQuantity('{{item.sku}}', '{{item.option}}', 'change')">
                            <button class="btn fa fa-plus p-1 mx-2" onclick="changeQuantity('{{item.sku}}', '{{item.option}}', 'increment')"></button>
                            <button class="btn fa fa-trash ml-5" style="color: #DC143C" onclick="deleteItem('{{item.sku}}', '{{item.option}}')"></button>
                        </div>
                    </div>
                </div>
                
                {% endfor %}
            </div>
            <div class="col-lg-4 col-2 sticky-top two">
                <h3 class="card-title">Cart items and price details</h3>
                <hr>
                <div class="column">
                    <div class="card row rounded m-1" style="height: 25rem;">
                        <div class="p-3">
                            <span class="float-left"><h4>Price ({{ items.item_count }} items)</h4></span> 
                            <span class="float-right"><h5>₹ {{ items.price }}</h5></span>
                        </div>
                        <div class="p-3">
                            <span class="float-left">Discount</span>
                            <span class="float-right">₹ {{ items.discount }}</span>
                        </div>
                        <hr>
                        <div class="p-3">
                            <span class="float-left">Total</span>
                            <span class="float-right">₹ {{ items.total }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> {% endcomment %}
{% endblock content %}
{% block customjs %}
<script>
    function alertbox(){
        alert("clicked");
    }
    function changeQuantity(sku, option, type){
        const id = sku+"-"+option+"-"+"quantity";
        const innerId = id + "-inner";
        var quantity = parseInt(document.getElementById(id).value);
        if (type === "increment"){
            if(quantity <= 0){
                quantity = 1
                document.getElementById(id).value = quantity;
                document.getElementById(innerId).innerHTML = quantity;
            } else{
                quantity += 1;
                document.getElementById(id).value = quantity;
                document.getElementById(innerId).innerHTML = quantity;
            }
            recalculate(id);
        }
        if(type === "decrement"){
            if(quantity <= 1){
                quantity = 1;
                document.getElementById(id).value = quantity;
                document.getElementById(innerId).innerHTML = quantity;
                document.getElementById(innerId).innerHTML = quantity;                
            } else{
                quantity -= 1;
                document.getElementById(id).value = quantity;
                document.getElementById(innerId).innerHTML = quantity;
            }
            recalculate(id);
        }
        if(type === "change"){
        if (quantity <= 1){
            quantity = 1
            document.getElementById(id).value = quantity;
            document.getElementById(innerId).innerHTML = quantity;
        }
            recalculate(id);
        }
        
    }
    
    function recalculate(id){
        var quantity = parseInt(document.getElementById(id).value);
        console.log("recalculating");
    }

    function deleteItem(sku, option){

        console.log("deleting");
        const id = sku+"-"+option+"-div";
        if (window.confirm("Please confirm delete")){
            document.getElementById(id).innerHTML = "";
        } else {
            console.log("delete cancelled")
        }
        
    }
</script>
{% endblock customjs %}